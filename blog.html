<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Macro Snap - Build Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/agency.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <img class="navbar-brand page-scroll" style="padding: 2px 10px 2px 10px" src="img/logos/piezosaurus.png" alt="dino logo">
                <a class="navbar-brand page-scroll" href="#page-top">Piezosaurus</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="index.html">Home</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="intro-text">
                <div class="intro-heading">Build Blog</div>
                <div class="intro-lead-in">Macro Snap: A wearable gesture detection armband to control mobile macros</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-preview">
                    <h2 class="post-title">
                        Week 5 Progress
                    </h2>
                    <p class="post-meta">Feb 10, 2023</p>
                    <h4 class="post-subtitle">New connectors arrived - Feb 6</h4>
                    The new connectors that we ordered have arrived. The 3D printed pieces need to be adjusted. 
                    <img style="margin-bottom: 20px;" src="img/blog/new-connectors.png" width="300" alt="New connector parts">
                </div>

                <hr>

                <div class="post-preview">
                    <h2 class="post-title">
                        Week 4 Progress
                    </h2>
                    <p class="post-meta">Posted on Feb 3, 2023</p>
                    <h4 class="post-subtitle">Creating 3 device macros - Jan 29</h4>
                    <p>In android studio a test UI was created with three buttons (one to execute each macro/task) and a text box outputs which task is clicked for debugging purposes. Since the Bluetooth functionality is not fully set up yet, the buttons are used in place to simulate a detection of a gesture from the band. The first task sets a timer for five seconds in the device’s clock app. The second task opens google maps and shows the location of Googleplex in California. The last task sets an alarm for 8am in the device's clock app. These three tasks make use of android intents for android developers. Some other tasks that were briefly looked into but not fully functioning are opening a webpage, making a call, taking a photo, and playing music on YouTube Music. For these tasks, more time is needed to debug and fine tune them. For some reason opening a webpage doesn’t function at the moment. Making a call requires a more complex permission request than most app intents, so that task was left to deal with later. Currently taking a photo does open the device's camera app but the user still needs to press the button to take the photo. Also the captured photo doesn’t properly save to the devices photo library. There doesn’t seem to be much existing documentation on how to play music through YouTube Music. Originally YouTube Music was chosen because that app was available on the emulator we were testing on. However we have acquired a physical device to test on which can have Spotify running from it. Spotify seems to have more documentation surrounding how to use app intents on it so that will be tested at a later date.</p>
                    <h4 class="post-subtitle">Finished firmware driver for Macro Snap haptics - Jan 31</h4>
                    <p>A piezoelectric haptic actuator is being used for feedback to the user on a successful gesture detection. In order to control the actuator, the BOS1901 is being used for boosting and controlling the 12Vpp waveform that causes vibration to the piezo device. To communicate with the BOS1901 and program it to output a certain waveform at a certain time, a SPI bus is connected between it and the NRF52811. This SPI bus was set up in the firmware that implements the Zephyr kernel and words are sent 8 bits at a time sending both the register address and data bytes. After some debugging and logging of the SPI bus on a debugger to make sure the correct data was being sent, the haptic actuator was successfully sent a waveform to cause a vibration detectable by the user. This firmware driver will be incorporated in the main firmware/software loop logic later on.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/haptics.png" width="300" alt="Compute module with haptics connected">
                    <h4 class="post-subtitle">Android app and wearable device communications - Feb 1</h4>
                    <p>After the app was able to read values from BLE. Progress is made towards storing data received from BLE and processing them into features for SVM. The frequency of scans received was also increased through a setting in the app so now it can scan for BLE data as fast as possible.</p>
                    <p>Since the wearable device sends data via BLE and does not receive anything back from the app, the app and wearable will communicate via different status byte values sent through BLE. The wearable device will be in charge of detecting the finger snap based on a calibrated threshold. Once the snap is detected, it will flip a bit in the BLE message and the app will know to start recording values for gesture detection. For calibration, the process will be triggered by a UI button press on the arm band. This would cause the calibration byte in the BLE message to update. The finger snap force is calibrated just on the wearable and stored in the Flash while the gesture calibration info is stored on the app since the wearable does not have enough storage for the SVM model. While going through each stage of calibration, the main idea is that the wearable device will be in charge of keepig track of which stage of the calibration is it in (i.e. how many gestures have been recorded) and the app will update the UI and store data based on the calibration byte. We designed it like this because the app can only receive data from the wearable device but not send data back.</p>
                </div>

                <hr>

                <div class="post-preview">
                    <h2 class="post-title">
                        Week 3 Progress
                    </h2>
                    <p class="post-meta">Posted on Jan 27, 2023</p>
                    <h4 class="post-subtitle">FSR connector module assembly - Jan 20</h4>
                    <p>We attempted the second set of Macro Snap connector modules assembly. Shortly after, we found our methodology was inaccurate and imprecise for the amount of build time that it took, in addition to the quality of the final product. The contacts made between the custom pogo pin magnetic connectors were not steady, and so we had to add elastic bands to the connectors to hold them together as the strength of the magnet was not sufficient to overcome build inaccuracies. The decision to buy off-the-shelf connectors was made, and a set of 5 pin magnetic pogo connectors was purchased.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/connector-elastic.jpg" width="250" alt="Connectors with elastic bands">
                    <img style="margin-left: 30px; margin-bottom: 20px;" src="img/blog/ordered-connectors.png" width="200" alt="New connectors we ordered">
                    <h4 class="post-subtitle">CAD and printing of 2nd iteration of housing components - Jan 23</h4>
                    <p>Since we decided to use off-the-shelf connectors, we needed to update the CAD models to accommodate them. We also just received the shipment for the LEDs that go into the modules. When we tried to put in the LED the slot in the housing for it was a bit too small so we also enlarged the slot in the compute module. However for the FSR modules, we are going to keep the old design and drill a larger hole for the LED. Since the tolerance for the old housing is pretty tight and we already placed the PCBs and FSR sensors, it is difficult and time consuming to take them out.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/printed-housing-v2.jpg" width="250" alt="CAD of component housing">
                    <h4 class="post-subtitle">BLE firmware development - Jan 24</h4>
                    <p>Firmware of the Macro Snap board was developed to broadcast all values read from the ADC, program status, calibration button status and the closed loop status (i.e. if the band has been fully connected back together). This was verified through the NRF Connect App as the correct packets were sent through the Eddystone Beacon setup on the device. This makes the device a BLE broadcaster with a specific packet structure for rapid broadcasting of FSR and status information to the Macro Snap app.</p>
                    <h4 class="post-subtitle">Android app receiving data from BLE beacon - Jan 26</h4>
                    <p>A BLE scanner is implemented in the Android app to receive data transmitted from the Macro Snap board. To filter out all other near by devices, we check that the device name matches ours. After receiving the service data (which is in a byte array) from the scan, we convert the items in the array to unsigned integer values which becomes the same as the broadcasted values. </p>
                    <img style="margin-bottom: 20px;" src="img/blog/ble-info.jpg" width="300" alt="BLE device info">
                </div>

                <hr>
                
                <div class="post-preview">
                    <h2 class="post-title">
                        Week 2 Progress
                    </h2>
                    <p class="post-meta">Posted on Jan 19, 2023</p>
                    <h4 class="post-subtitle">Assembled first batch of Macro Snap PCBs - Jan 14</h4>
                    <p>Using the reflow method of PCB assembly, I aligned a stencil to three Macro Snap Main Logic Boards (MLBs) and applied solder paste to the boards. I then used all of the components ordered previously and a set of tweezers to carefully place the components onto the relevant pads. This was done carefully as some of the packages for the components were quite small, including the chip antenna that was sized as an 0201 component. Once all components were carefully placed, all three PCBs were placed into a reflow oven that was set with the same heating profile as indicated by the solder paste datasheet. Once completed, the boards were removed and then visually inspected for any shifted components or solder bridges during reflow. These issues were reworked, which lead to the final step of power and debug validation that consisted of testing the power rails for continuity, isolation and appropriate voltage in addition to communication with the main MCU over the debug protocol. Once this was verified, the first order bring-up of the MLBs was complete.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/compute-pcb.jpg" width="300" alt="Compute module PCB front and back views">
                    <h4 class="post-subtitle">Manufacturing of first set of connector modules - Jan 15</h4>
                    <p>In order to route the “Macro-bus” that contains the main voltage and analog rails from each of the FSRs and direct them to the compute module, specific connector modules that will also allow the user to resize the armband were created. They contain a printed male and female bracket, 2 magnets, ribbon cable, 5 pogo pins and 5 contact pads to create magnetic pogo pin connectors that will snap and mate together to extend an armband while routing the main signals.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/connector-v1.png" width="300" alt="Views of connector modules">
                    <h4 class="post-subtitle">Getting started on the Android app - Jan 17</h4>
                    <p>To run the SVM on the app, we found Smile, a library containing machine learning algorithms for languages including Java and Kotlin. This is perfect for us to use in the Android app. We tried out the library in a Jupyter Notebook using a small dataset of FSR sensor values we gathered previously using an Arduino and used the data to train a SVM. We were able to achieve ~80% accuracy with cross validation which was similar to the results we've seen before.</p>
                    <p>In order to use Smile library on an Android device, it needs to have a minSdkVersion of 26 and our devices used an older version. So we decided to use an emulator for app development for now. We were able to run the SVM in the emulator, but had some trouble reading and writing files to internal storage since we are new to Android development. </p>
                </div>

                <hr>
                
                <div class="post-preview">
                    
                    <h2 class="post-title">
                        Week 1 & MTE 481 Progress
                    </h2>
                    <p class="post-meta">Posted on Jan 12, 2023</p>
                    <h4 class="post-subtitle">Designed PCBs - Nov 5</h4>
                    <p>In order to fit the electronics needed for the Macro Snap project on a wearable device, close collaboration with the mechanical team was required to dimension the boards correctly. This defined the amount of components and size of battery that could fit in the device. From size constraints and determining the sensor specifications, (FSR circuits, haptic module, LED indicators) schematics were created in Altium Designer. These schematics were then used to layout the PCBs for the FSR, compute and connector modules.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/compute-pcb-design.png" height="150" alt="Compute module PCB design render">
                    <img style="margin-bottom: 20px;" src="img/blog/fsr-pcb-design.png" height="150" alt="FSR module PCB design render">
                    <h4 class="post-subtitle">Designed housing for components - Nov 20</h4>
                    <p>Along with the design of the PCBs, the CAD is created to house each component. The product consists of three types of modules: the compute, FSR, and interlock modules, that joined together to create the armband. Our mechanical design is minimal and as small as possible so that it is unobtrusive to the user. These modules will be 3D printed and assembled together.</p>
                    <img style="margin-bottom: 20px;" src="img/blog/cad.png" width="350" alt="CAD of component housing">
                    <h4 class="post-subtitle">Sent PCBs to be fabricated and ordered BOM - Dec 27</h4>
                    <p>Once the PCBs had been designed and the BOM finalized based on active and in stock components, the PCBs were manufactured as 4 layer boards at JLCPCB. The components were all sourced and purchased from Digikey.</p>
                    <h4 class="post-subtitle">Using libsvm for SVM training and inference - Jan 7</h4>
                    <p>Libsvm is a simple and efficient open source C/C++ library for SVM classification and regression. Our initial plan was to use this to perform gesture classification on the wearable device. We performed initial testing of the code to ensure that it runs on the device without issue. We only had to modify the code such that it does not read and write data from files since that is not supported on the device.</p>
                    <p>Unfortunately the chip does not have enough FLASH/RAM for training or saving the model so we are pivoting to running the SVM on the Android app instead.</p>
                    <h4 class="post-subtitle">Assembled first Macro Snap prototype - Jan 8</h4>
                    <p>We checked that electronics fit into 3D printed housings and made list of changes that need to be made or extra parts that need to be created.</p>
                    <ul>
                        <li>Increase pogo pins size on connector</li>
                        <li>Remove PCB and LED slot in connector module</li>
                        <li>Make the battery cover less tight</li>
                        <li>Create a 5 contact pad and 5 pogo pin holder tool to help with soldering</li>
                        <li>Make big hole deeper for contact pads</li>
                        <li>Make ribbon cable wires bigger (x2 height, 1.33 width)</li>
                        <li>Modify interlock mechanism so when it slides in place, the wires won’t cross</li>
                        <li>Remove the backing for the wire connector (will use heat shrink to keep the wires together instead of housing)</li>
                    </ul>
                    <img style="margin-bottom: 20px;" src="img/blog/printed-housing.jpg" width="450" alt="PCB inside 3D printed housings">
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <!-- <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Copyright &copy; Your Website 2014</p>
                </div>
            </div>
        </div>
    </footer> -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/cbpanimatedheader.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/agency.js"></script>

</body>

</html>